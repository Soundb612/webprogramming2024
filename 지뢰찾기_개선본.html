<!DOCTYPE html>
<html lang="ko">

<head>
    <style>
        * {
            text-align: center;
        }

        body {
            background-color: #f0f8ff; /* ë°°ê²½ìƒ‰ */
            font-family: Arial, sans-serif; /* í°íŠ¸ ì„¤ì • */
        }

        #board {
            margin-left: auto;
            margin-right: auto;
            border-collapse: collapse; /* í…Œì´ë¸” ê²½ê³„ ì„¤ì • */
        }

        #board tr td {
            border: 1px solid white; /* ì¹¸ì˜ í…Œë‘ë¦¬ ìƒ‰ìƒ */
            background: #34da79; /* ê¸°ë³¸ ì¹¸ ìƒ‰ìƒ */
            width: 30px; /* ì¹¸ ë„ˆë¹„ */
            height: 30px; /* ì¹¸ ë†’ì´ */
            text-align: center;
            cursor: pointer; /* ë§ˆìš°ìŠ¤ í¬ì¸í„° ë³€ê²½ */
        }

        #board tr td.clicked {
            background: #6c5ee7; /* í´ë¦­í•œ ì¹¸ ìƒ‰ìƒ */
        }

        #board tr td.mine {
            background: #FF0000; /* ì¼ë°˜ ì§€ë¢° ì¹¸ ìƒ‰ìƒ */
        }

        #board tr td.trap {
            background: #800080; /* í•¨ì •ì§€ë¢° ì¹¸ ìƒ‰ìƒ (ë³´ë¼ìƒ‰) */
        }

        #timer {
            font-size: 20px; /* íƒ€ì´ë¨¸ ê¸€ì”¨ í¬ê¸° */
            margin-top: 20px; /* íƒ€ì´ë¨¸ ìœ„ ì—¬ë°± */
        }
    </style>
</head>

<body>
    <h1>ì§€ë¢°ì°¾ê¸°</h1>
    <div id="timer">ë‚¨ì€ ì‹œê°„: <span id="time">600</span>ì´ˆ</div>
    <table id="board"></table>
    <button onclick="genGrid();">ìƒˆë¡œìš´ ê²Œì„</button>
    <script>
        let grid = document.getElementById("board");
        let timerElement = document.getElementById("time");
        let timeLimit = 600; // 10ë¶„ ì œí•œ ì‹œê°„ (600ì´ˆ)
        let interval; // íƒ€ì´ë¨¸ ì¸í„°ë²Œ
        let firstClick = true; // ì²« í´ë¦­ ì—¬ë¶€
        let totalSafeCells; // ì•ˆì „í•œ ì¹¸ì˜ ì´ ìˆ˜
        let clickedSafeCells = 0; // í´ë¦­í•œ ì•ˆì „í•œ ì¹¸ì˜ ìˆ˜

        genGrid(); // ì´ˆê¸° ê²Œì„ ìƒì„±

        function genGrid() {
            clearInterval(interval); // ì´ì „ íƒ€ì´ë¨¸ ì¤‘ì§€
            timerElement.innerText = timeLimit; // íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            startTimer(); // íƒ€ì´ë¨¸ ì‹œì‘

            grid.innerHTML = ""; // ê¸°ì¡´ ê²Œì„íŒ ì´ˆê¸°í™”
            let mines = Array(10).fill().map(() => Array(10).fill(false)); // 10x10 ë°°ì—´ ì´ˆê¸°í™”

            // ì§€ë¢° ë°°ì¹˜
            for (let i = 0; i < 10; i++) { // ì§€ë¢° ìˆ˜
                let x, y;
                do {
                    x = Math.floor(Math.random() * 10);
                    y = Math.floor(Math.random() * 10);
                } while (mines[x][y]); // ì´ë¯¸ ì§€ë¢°ê°€ ìˆëŠ” ìœ„ì¹˜ëŠ” ì œì™¸
                mines[x][y] = true; // ì§€ë¢° ìœ„ì¹˜ ì„¤ì •
            }

            // í•¨ì •ì§€ë¢° ë°°ì¹˜ (2ê°œë¡œ ì œí•œ)
            for (let i = 0; i < 2; i++) { // í•¨ì •ì§€ë¢° ìˆ˜
                let x, y;
                do {
                    x = Math.floor(Math.random() * 10);
                    y = Math.floor(Math.random() * 10);
                } while (mines[x][y] === true || mines[x][y] === "trap"); // ì¼ë°˜ ì§€ë¢°ì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì„¤ì •
                mines[x][y] = "trap"; // í•¨ì •ì§€ë¢° ìœ„ì¹˜ ì„¤ì •
            }

            totalSafeCells = 100 - (10 + 2); // ì´ ì•ˆì „í•œ ì¹¸ ìˆ˜ ê³„ì‚°

            // ê²Œì„íŒ ìƒì„±
            for (let i = 0; i < 10; i++) {
                let row = grid.insertRow(i);
                for (let j = 0; j < 10; j++) {
                    let cell = row.insertCell(j);
                    cell.onclick = function () { clickBox(this, mines); }; // í´ë¦­ ì´ë²¤íŠ¸
                    cell.oncontextmenu = function (e) { e.preventDefault(); flagCell(this); }; // ìš°í´ë¦­ ì´ë²¤íŠ¸
                    cell.setAttribute("mine", mines[i][j] ? (mines[i][j] === "trap" ? "trap" : "true") : "false"); // ì¹¸ì— ì§€ë¢° ì†ì„± ì„¤ì •
                }
            }
        }

        function clickBox(cell, mines) {
            if (firstClick) {
                // ì²« í´ë¦­ì¼ ê²½ìš° ì•ˆì „í•˜ê²Œ ì§€ë¢°ë¥¼ ì¬ë°°ì¹˜
                firstClick = false;
                resetMines(cell, mines);
            }

            if (cell.getAttribute("mine") === "true") {
                cell.className = "mine"; // ì¼ë°˜ ì§€ë¢° í´ë¦­
                clearInterval(interval); // íƒ€ì´ë¨¸ ì¤‘ì§€
                alert("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ë¢°ë¥¼ í´ë¦­í–ˆìŠµë‹ˆë‹¤."); // ì¢…ë£Œ ë©”ì‹œì§€
            } else if (cell.getAttribute("mine") === "trap") {
                cell.className = "trap"; // í•¨ì •ì§€ë¢° í´ë¦­
                alert("í•¨ì • ì§€ë¢°ì— ê±¸ë ¸ìŠµë‹ˆë‹¤!"); // í•¨ì • ë©”ì‹œì§€
            } else {
                cell.className = "clicked"; // ì•ˆì „í•œ ì¹¸ í´ë¦­
                clickedSafeCells++; // í´ë¦­í•œ ì•ˆì „í•œ ì¹¸ ìˆ˜ ì¦ê°€

                // ì£¼ë³€ ì§€ë¢° ìˆ˜ ê³„ì‚°
                let mineCount = countMines(cell, mines);
                if (mineCount > 0) {
                    cell.innerText = mineCount; // ì£¼ë³€ ì§€ë¢° ìˆ˜ í‘œì‹œ
                } else {
                    // ì£¼ë³€ì— ì§€ë¢°ê°€ ì—†ì„ ê²½ìš° ì—°ì‡„ì ìœ¼ë¡œ ì—´ê¸°
                    openAdjacentCells(cell, mines);
                }
            }
            checkVictory(); // ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸
        }

        function flagCell(cell) {
            if (!cell.classList.contains('clicked')) {
                cell.classList.toggle('flag'); // ê¹ƒë°œ í‘œì‹œ ì „í™˜
                cell.innerText = cell.classList.contains('flag') ? 'ğŸš©' : ''; // ê¹ƒë°œ ì´ëª¨ì§€ í‘œì‹œ
            }
        }

        function resetMines(firstCell, mines) {
            // ì²« í´ë¦­ í›„ ì•ˆì „í•˜ê²Œ ì§€ë¢° ì¬ë°°ì¹˜
            let x = firstCell.parentNode.rowIndex;
            let y = firstCell.cellIndex;

            // ì²« í´ë¦­ ìœ„ì¹˜ ì£¼ë³€ ì§€ë¢° ì œê±°
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (x + i >= 0 && x + i < 10 && y + j >= 0 && y + j < 10) {
                        mines[x + i][y + j] = false; // ì²« í´ë¦­ ì£¼ë³€ì˜ ì§€ë¢° ì œê±°
                    }
                }
            }

            // ìƒˆë¡œìš´ ì§€ë¢° ë°°ì¹˜
            for (let i = 0; i < 10; i++) {
                let newX, newY;
                do {
                    newX = Math.floor(Math.random() * 10);
                    newY = Math.floor(Math.random() * 10);
                } while (mines[newX][newY] === true || mines[newX][newY] === "trap"); // ì´ë¯¸ ì§€ë¢°ê°€ ìˆëŠ” ìœ„ì¹˜ëŠ” ì œì™¸
                mines[newX][newY] = true; // ìƒˆë¡œìš´ ì§€ë¢° ìœ„ì¹˜ ì„¤ì •
            }
        }

        function openAdjacentCells(cell, mines) {
            let x = cell.parentNode.rowIndex; // í˜„ì¬ í´ë¦­í•œ ì¹¸ì˜ í–‰ ì¸ë±ìŠ¤
            let y = cell.cellIndex; // í˜„ì¬ í´ë¦­í•œ ì¹¸ì˜ ì—´ ì¸ë±ìŠ¤

            // ì£¼ë³€ 8ì¹¸ ê²€ì‚¬
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue; // ìê¸° ìì‹ ì€ ì œì™¸
                    let newX = x + i, newY = y + j;
                    if (newX >= 0 && newX < 10 && newY >= 0 && newY < 10) {
                        let adjacentCell = grid.rows[newX].cells[newY];
                        if (!adjacentCell.classList.contains('clicked')) {
                            clickBox(adjacentCell, mines); // ì¬ê·€ì ìœ¼ë¡œ í´ë¦­
                        }
                    }
                }
            }
        }

        function countMines(cell, mines) {
            let x = cell.parentNode.rowIndex; // í˜„ì¬ í´ë¦­í•œ ì¹¸ì˜ í–‰ ì¸ë±ìŠ¤
            let y = cell.cellIndex; // í˜„ì¬ í´ë¦­í•œ ì¹¸ì˜ ì—´ ì¸ë±ìŠ¤
            let count = 0;

            // ì£¼ë³€ 8ì¹¸ ê²€ì‚¬
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue; // ìê¸° ìì‹ ì€ ì œì™¸
                    let newX = x + i, newY = y + j;
                    if (newX >= 0 && newX < 10 && newY >= 0 && newY < 10) {
                        if (mines[newX][newY] === true) {
                            count++;
                        }
                    }
                }
            }
            return count; // ì£¼ë³€ ì§€ë¢° ìˆ˜
        }

        function checkVictory() {
            if (clickedSafeCells === totalSafeCells) {
                clearInterval(interval); // íƒ€ì´ë¨¸ ì¤‘ì§€
                alert("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ì•ˆì „í•œ ì¹¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!"); // ìŠ¹ë¦¬ ë©”ì‹œì§€
            }
        }

        function startTimer() {
            interval = setInterval(function () {
                timeLimit--;
                timerElement.innerText = timeLimit; // ë‚¨ì€ ì‹œê°„ ì—…ë°ì´íŠ¸
                if (timeLimit <= 0) {
                    clearInterval(interval); // íƒ€ì´ë¨¸ ì¤‘ì§€
                    alert("ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ê²Œì„ ì¢…ë£Œ."); // ì‹œê°„ ì´ˆê³¼ ë©”ì‹œì§€
                }
            }, 1000);
        }
    </script>
</body>

</html>
